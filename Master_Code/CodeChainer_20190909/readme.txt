
//////////////////////系统总框架程序//////////////////////
程序列表


1.led程序
2.key程序-扫描薄膜按键，进行各种模式选择
3.delay程序
4.systick滴答程序--用于各类延时
5.usart，串口1程序-gprs程序  串口2 --蓝牙程序  串口3 液晶显示程序
6.printf使用程序
7.加入modbus程序,进行寄存器的读写。
8.加入GPRS程序 。
9.加入w25q64的flash读写程序
10.加入SI4438程序




心跳包为60s一次




存储表示格式：


序列号放第0个扇区
IP地址和端口号放第1个扇区
传感器列表放第2个扇区

20190507  增加版本号   程序完结
20190513  增加未收到传感器的标志位  12分钟内没收到传感器数据，则重启系统。

瓯海  admin  wlw_show    20190607

在gprs.c 210行加入看门狗喂狗代码 IWDG_Feed();  因为平台IP地址迁移，时间会比较长，如果没喂狗就会导致复位。
IWDG_Init(7,4000); 更改在main.c里面的初始化看门狗配置  变成51S


2019.09.09  出现存储的flash数据丢失

分析如下：

	1.有可能在进入GPRS更改flash模式的时候，更改flash前出现芯片复位（一种可能是看门狗时间到了，还有一种可能是没有心跳包的数据发现，就重启）
	2.有可能程序一进入，串口受到了干扰，进入了更改flash操作，而又没有外部输入，所以里面的数据都为0 
	3.可能是电源不稳定（暂时排除这个原因，如果是电源不稳定引起的话，整个存储芯片内部的数据会全部清零，但是通过这几个寄回来的设备看，数据有部分的而不是全部没有。）
	
更改

	1.加入复位前的判断机制，是否在更改flash，在每次擦除前，先喂狗，确定操作flash没有问题。包括在操作flash关闭所有中断功能
	2.SPI_FLASH_Write_Disable(); //加入写禁止功能，只有写的时候才打开，为了保护芯片不在特定情况下被改写。
	3.在做擦除和写操作之前，先判断数据是否完整，只有数据完整才进行操作。
	
	
	
	
	
	